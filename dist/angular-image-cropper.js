!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("angular")):"function"==typeof define&&define.amd?define(["angular"],e):"object"==typeof exports?exports.imageCropper=e(require("angular")):t.imageCropper=e(t.angular)}(this,function(__WEBPACK_EXTERNAL_MODULE_7__){return function(t){function e(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var o=i(7),n=(o.module("imageCropper",[]),i(5));i(6)(o,n),t.exports="imageCropper"},function(t,e,i){e=t.exports=i(2)(),e.push([t.id,"body.imgCropper-dragging,body.imgCropper-dragging *{cursor:move!important;cursor:-webkit-grabbing!important;cursor:grabbing!important;cursor:grabbing,move}.imgCropper-wrapper{display:block;position:relative;overflow:hidden;cursor:move;cursor:-webkit-grab;cursor:grab;cursor:grab,move}.imgCropper-container{text-align:center}.imgCropper-container,.imgCropper-container>*{position:absolute;top:0;left:0;margin:0!important;padding:0!important;border:none!important}.imgCropper-container>*{max-width:none;max-height:none;width:100%;height:100%}.imgCropper-sample{position:absolute!important;top:-100000px!important;left:-100000px!important;width:auto!important;height:auto!important}",""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var i=this[e];i[2]?t.push("@media "+i[2]+"{"+i[1]+"}"):t.push(i[1])}return t.join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},n=0;n<this.length;n++){var s=this[n][0];"number"==typeof s&&(o[s]=!0)}for(n=0;n<e.length;n++){var r=e[n];"number"==typeof r[0]&&o[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),t.push(r))}},t}},function(t,e,i){function o(t,e){for(var i=0;i<t.length;i++){var o=t[i],n=g[o.id];if(n){n.refs++;for(var s=0;s<n.parts.length;s++)n.parts[s](o.parts[s]);for(;s<o.parts.length;s++)n.parts.push(l(o.parts[s],e))}else{for(var r=[],s=0;s<o.parts.length;s++)r.push(l(o.parts[s],e));g[o.id]={id:o.id,refs:1,parts:r}}}}function n(t){for(var e=[],i={},o=0;o<t.length;o++){var n=t[o],s=n[0],r=n[1],a=n[2],h=n[3],l={css:r,media:a,sourceMap:h};i[s]?i[s].parts.push(l):e.push(i[s]={id:s,parts:[l]})}return e}function s(t,e){var i=f(),o=b[b.length-1];if("top"===t.insertAt)o?o.nextSibling?i.insertBefore(e,o.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),b.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");i.appendChild(e)}}function r(t){t.parentNode.removeChild(t);var e=b.indexOf(t);e>=0&&b.splice(e,1)}function a(t){var e=document.createElement("style");return e.type="text/css",s(t,e),e}function h(t){var e=document.createElement("link");return e.rel="stylesheet",s(t,e),e}function l(t,e){var i,o,n;if(e.singleton){var s=y++;i=v||(v=a(e)),o=p.bind(null,i,s,!1),n=p.bind(null,i,s,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=h(e),o=d.bind(null,i),n=function(){r(i),i.href&&URL.revokeObjectURL(i.href)}):(i=a(e),o=c.bind(null,i),n=function(){r(i)});return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else n()}}function p(t,e,i,o){var n=i?"":o.css;if(t.styleSheet)t.styleSheet.cssText=w(e,n);else{var s=document.createTextNode(n),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(s,r[e]):t.appendChild(s)}}function c(t,e){var i=e.css,o=e.media;e.sourceMap;if(o&&t.setAttribute("media",o),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function d(t,e){var i=e.css,o=(e.media,e.sourceMap);o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var n=new Blob([i],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(n),s&&URL.revokeObjectURL(s)}var g={},m=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},u=m(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),f=m(function(){return document.head||document.getElementsByTagName("head")[0]}),v=null,y=0,b=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=u()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var i=n(t);return o(i,e),function(t){for(var s=[],r=0;r<i.length;r++){var a=i[r],h=g[a.id];h.refs--,s.push(h)}if(t){var l=n(t);o(l,e)}for(var r=0;r<s.length;r++){var h=s[r];if(0===h.refs){for(var p=0;p<h.parts.length;p++)h.parts[p]();delete g[h.id]}}}};var w=function(){var t=[];return function(e,i){return t[e]=i,t.filter(Boolean).join("\n")}}()},function(t,e,i){var o=i(1);"string"==typeof o&&(o=[[t.id,o,""]]);i(3)(o,{});o.locals&&(t.exports=o.locals)},function(t,e){function i(t){if(!t.imageUrl)throw new Error("Cropper: No image url given.");this.isReady=!1,this.originalUrl=t.imageUrl;var e={checkCrossOrigin:!1,apiCallback:void 0,cropCallback:void 0,width:400,height:300,imageUrl:void 0,target:void 0,showControls:!0,fitOnInit:!1,centerOnInit:!1,zoomStep:.1,actionLabels:{rotateLeft:" < ",rotateRight:" > ",zoomIn:" + ",zoomOut:" - ",fit:"(fit)",crop:"[crop]"}};this.options=this.extend(e,t),this.gesture={},this.gesture.events={start:"touchstart mousedown",move:"touchmove mousemove",stop:"touchend mouseup"},this.pointerPosition=void 0,this.elements={target:t.target,body:document.getElementsByTagName("body")[0]},this.buildDOM(),this.useHardwareAccelerate(this.elements.image);var i={crop:this.cropImage.bind(this),fit:this.applyFit.bind(this),rotate:this.applyRotation.bind(this),zoomIn:this.applyZoomIn.bind(this),zoomOut:this.applyZoomOut.bind(this),remove:this.remove.bind(this)};this.events.on("ImageReady",this.initialize.bind(this)),this.options.cropCallback&&this.events.on("Cropped",function(t){this.options.cropCallback(t)}.bind(this)),this.options.apiCallback&&this.events.on("ImageReady",function(){this.options.apiCallback(i)}.bind(this))}t.exports=i,i.prototype.initialize=function(){this.setDimensions(),this.imageHasToFit()&&(this.fitImage(),this.centerImage()),this.initializeGesture(),this.options.centerOnInit&&this.centerImage(),this.options.showControls&&this.bindControls()},i.prototype.bindControls=function(){var t=this;this.elements.controls.rotateLeft.addEventListener("click",function(){t.applyRotation(-90)}),this.elements.controls.rotateRight.addEventListener("click",function(){t.applyRotation(90)}),this.elements.controls.zoomIn.addEventListener("click",function(){t.applyZoomIn(t.zoomInFactor)}),this.elements.controls.zoomOut.addEventListener("click",function(){t.applyZoomOut(t.zoomOutFactor)}),this.elements.controls.fit.addEventListener("click",this.applyFit.bind(this)),this.elements.controls.crop.addEventListener("click",this.cropImage.bind(this))},i.prototype.applyRotation=function(t){this.rotateImage(t)},i.prototype.applyZoomIn=function(t){this.zoomImage(1+parseFloat(t))},i.prototype.applyZoomOut=function(t){this.zoomImage(1/(1+parseFloat(t)))},i.prototype.applyFit=function(){this.fitImage(),this.centerImage()},i.prototype.imageHasToFit=function(){return this.elements.image.naturalWidth<this.options.width||this.elements.image.naturalHeight<this.options.height||this.width<1||this.height<1||this.options.fitOnInit},i.prototype.buildDOM=function(){var t;return t=this.elements,t.wrapper=document.createElement("div"),t.wrapper.className="imgCropper-wrapper",t.container=document.createElement("div"),t.container.className="imgCropper-container",t.image=document.createElement("img"),t.image.className="imgCropper-image",t.container.appendChild(t.image),t.wrapper.appendChild(t.container),t.target.appendChild(t.wrapper),this.options.showControls?(t.controls={},t.controls.wrapper=document.createElement("div"),t.controls.wrapper.className="imgCropper-controls",t.controls.rotateLeft=this._buildControl(this.options.actionLabels.rotateLeft),t.controls.rotateRight=this._buildControl(this.options.actionLabels.rotateRight),t.controls.zoomIn=this._buildControl(this.options.actionLabels.zoomIn),t.controls.zoomOut=this._buildControl(this.options.actionLabels.zoomOut),t.controls.fit=this._buildControl(this.options.actionLabels.fit),t.controls.crop=this._buildControl(this.options.actionLabels.crop),t.controls.wrapper.appendChild(t.controls.rotateLeft),t.controls.wrapper.appendChild(t.controls.zoomOut),t.controls.wrapper.appendChild(t.controls.fit),t.controls.wrapper.appendChild(t.controls.crop),t.controls.wrapper.appendChild(t.controls.zoomIn),t.controls.wrapper.appendChild(t.controls.rotateRight),t.target.appendChild(t.controls.wrapper),void this.loadImage()):this.loadImage()},i.prototype._buildControl=function(t){var e=document.createElement("button");return e.setAttribute("type","button"),e.innerHTML=t,e},i.prototype.remove=function(){var t=this.elements;t.target.removeChild(t.wrapper),this.options.showControls&&t.target.removeChild(t.controls.wrapper)},i.prototype.changeImage=function(t){"undefined"!=typeof t&&""!==t&&(this.originalUrl=t,this.loadImage())},i.prototype.loadImage=function(){console.log("loadImage called.");var t,e=this;return/^data\:/.test(this.originalUrl)?(console.log("loading "+this.originalUrl),this.originalBase64=this.originalUrl,this.setupImageSRC()):(t=new XMLHttpRequest,t.onerror=t.onabort=function(t){e.originalBase64=e.originalUrl,e.setupImageSRC()},t.onload=function(){e.originalArrayBuffer=this.response,e.originalBase64="data:image/jpeg;base64,"+e.base64ArrayBuffer(this.response),e.setupImageSRC()},t.open("get",this.originalUrl,!0),t.responseType="arraybuffer",void t.send())},i.prototype.setupImageSRC=function(){var t=this.elements.image;console.log("setup image src: ",t),this.options.checkCrossOrigin&&this.isCrossOrigin(this.originalUrl)&&(this.crossOrigin=t.crossOrigin,this.crossOrigin?this.crossOrigin=this.originalUrl:(this.crossOrigin="anonymous",this.crossOriginUrl=this.addTimestamp(this.originalUrl))),this.crossOrigin&&(this.elements.image.crossOrigin=this.crossOrigin),this.elements.image.src=this.crossOriginUrl||this.originalUrl,this.elements.image.onload=function(){this.events.triggerHandler("ImageReady")}.bind(this)},i.prototype.setDimensions=function(){this.zoomInFactor=1+parseFloat(this.options.zoomStep),this.zoomOutFactor=1/this.zoomInFactor,this.imageRatio=this.options.height/this.options.width,this.width=this.elements.image.naturalWidth/this.options.width,this.height=this.elements.image.naturalHeight/this.options.height,this.left=0,this.top=0,this.angle=0,this.data={scale:1,degrees:0,x:0,y:0,w:this.options.width,h:this.options.height},this.elements.container.style.width=100*this.width+"%",this.elements.container.style.height=100*this.height+"%",this.elements.container.style.top=0,this.elements.container.style.left=0,this.elements.wrapper.style.height="auto",this.elements.wrapper.style.width="100%",this.elements.wrapper.style.paddingTop=100*this.imageRatio+"%",this.isReady=!0},i.prototype.initializeGesture=function(){var t=this;this.addEventListeners(this.elements.image,this.gesture.events.start,function(i){t.isReady&&t.isValidEvent(i)&&(i.preventDefault(),i.stopImmediatePropagation(),t.pointerPosition=t.getPointerPosition(i),e())});var e=function(){t.elements.body.classList.add("imgCropper-dragging"),t.addEventListeners(t.elements.body,t.gesture.events.move,o),t.addEventListeners(t.elements.body,t.gesture.events.stop,i)},i=function(){t.elements.body.classList.remove("imgCropper-dragging"),t.removeEventListeners(t.elements.body,t.gesture.events.move,o),t.removeEventListeners(t.elements.body,t.gesture.events.stop,i)},o=function(e){t.dragging.call(t,e)}},i.prototype.dragging=function(t){var e,i,o,n,s;t.preventDefault(),t.stopImmediatePropagation(),n=this.getPointerPosition(t),e=n.x-this.pointerPosition.x,i=n.y-this.pointerPosition.y,this.pointerPosition=n,o=0===e?null:this.left-e/this.elements.wrapper.clientWidth,s=0===i?null:this.top-i/this.elements.wrapper.clientHeight,this.setOffset(o,s)},i.prototype.setOffset=function(t,e){(t||0===t)&&(t<0&&(t=0),t>this.width-1&&(t=this.width-1),this.elements.container.style.left=(100*-t).toFixed(2)+"%",this.left=t,this.data.x=Math.round(t*this.options.width)),(e||0===e)&&(e<0&&(e=0),e>this.height-1&&(e=this.height-1),this.elements.container.style.top=(100*-e).toFixed(2)+"%",this.top=e,this.data.y=Math.round(e*this.options.height))},i.prototype.fitImage=function(){var t,e;t=this.width,e=this.height/this.width,e>1?(this.width=1,this.height=e):(this.width=1/e,this.height=1),this.elements.container.style.width=(100*this.width).toFixed(2)+"%",this.elements.container.style.height=(100*this.height).toFixed(2)+"%",this.data.scale*=this.width/t},i.prototype.centerImage=function(){this.setOffset((this.width-1)/2,(this.height-1)/2)},i.prototype.rotateImage=function(t){if(0===t||t%90!==0)throw new Error("Cropper: Support only multiple of 90° for rotation.");if(this.angle=(this.angle+t)%360,this.angle<0&&(this.angle+=360),t%180!==0){var e=this.height*this.imageRatio,i=this.width/this.imageRatio;this.width=e,this.height=i,this.width>=1&&this.height>=1?(this.elements.container.style.width=100*this.width+"%",this.elements.container.style.height=100*this.height+"%"):this.fitImage()}var o=1,n=1;if(this.angle%180!==0){var s=this.height/this.width*this.imageRatio;o=s,n=1/s}this.elements.image.style.width=100*o+"%",this.elements.image.style.height=100*n+"%",this.elements.image.style.left=(1-o)/2*100+"%",this.elements.image.style.top=(1-n)/2*100+"%",this.elements.image.style.transform="rotate("+this.angle+"deg)",this.elements.image.style.webkitTransform="rotate("+this.angle+"deg)",this.elements.image.style.mozTransform="rotate("+this.angle+"deg)",this.elements.image.style.msTransform="rotate("+this.angle+"deg)",this.elements.image.style.oTransform="rotate("+this.angle+"deg)",this.centerImage(),this.data.degrees=this.angle},i.prototype.zoomImage=function(t){if(!(t<=0||1==t)){var e=this.width;this.width*t>1&&this.height*t>1?(this.height*=t,this.width*=t,this.elements.container.style.height=(100*this.height).toFixed(2)+"%",this.elements.container.style.width=(100*this.width).toFixed(2)+"%",this.data.scale*=t):(this.fitImage(),t=this.width/e);var i=(this.left+.5)*t-.5,o=(this.top+.5)*t-.5;this.setOffset(i,o)}},i.prototype.cropImage=function(){return this.cropHandler()},i.prototype.cropHandler=function(){var t,e;t=document.createElement("canvas"),t.height=this.options.height,t.width=this.options.width;var i=-t.width/2,o=-t.height/2;e=t.getContext("2d"),e.translate(-i,-o),e.rotate(this.data.degrees*Math.PI/180),e.scale(this.data.scale,this.data.scale),0==this.data.degrees?e.drawImage(this.elements.image,(i-this.data.x)/this.data.scale,(o-this.data.y)/this.data.scale):90==this.data.degrees?e.drawImage(this.elements.image,(o-this.data.y)/this.data.scale,-1*this.elements.image.naturalHeight+(-i+this.data.x)/this.data.scale):180==this.data.degrees?e.drawImage(this.elements.image,-1*this.elements.image.naturalWidth+(-i+this.data.x)/this.data.scale,-1*this.elements.image.naturalHeight+(-o+this.data.y)/this.data.scale):270==this.data.degrees&&e.drawImage(this.elements.image,-1*this.elements.image.naturalWidth+(-o+this.data.y)/this.data.scale,(i-this.data.x)/this.data.scale);var n=t.toDataURL("image/jpeg");return this.events.triggerHandler("Cropped",n),n},i.prototype.useHardwareAccelerate=function(t){t.style.perspective="1000px",t.style.backfaceVisibility="hidden"},i.prototype.extend=function(t,e){var i=t,o=Object.keys(t);return o.forEach(function(t,o,n){void 0!==e[t]&&(i[t]=e[t])}),i},i.prototype.addEventListeners=function(t,e,i,o){e.split(" ").forEach(function(e){o?t.addEventListener(e,i.bind(o),!1):t.addEventListener(e,i,!1)})},i.prototype.removeEventListeners=function(t,e,i,o){e.split(" ").forEach(function(e){o?t.removeEventListener(e,i.bind(o),!1):t.removeEventListener(e,i,!1)})},i.prototype.getPointerPosition=function(t){return this.isTouchEvent(t)&&(t=t.touches[0]),{x:t.pageX,y:t.pageY}},i.prototype.isValidEvent=function(t){return this.isTouchEvent(t)?1===t.changedTouches.length:1===t.which},i.prototype.isTouchEvent=function(t){return/touch/i.test(t.type)},i.prototype.addTimestamp=function(t){var e="timestamp="+(new Date).getTime(),i="?";return t.indexOf("?")!==-1&&(i="&"),t.concat(i,e)},i.prototype.isCrossOrigin=function(t){var e=t.match();return Boolean(e&&(e[1]!==location.protocol||e[2]!==location.hostname||e[3]!==location.port))},i.prototype.base64ArrayBuffer=function(t){for(var e,i,o,n,s,r="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=new Uint8Array(t),l=h.byteLength,p=l%3,c=l-p,d=0;d<c;d+=3)s=h[d]<<16|h[d+1]<<8|h[d+2],e=(16515072&s)>>18,i=(258048&s)>>12,o=(4032&s)>>6,n=63&s,r+=a[e]+a[i]+a[o]+a[n];return 1==p?(s=h[c],e=(252&s)>>2,i=(3&s)<<4,r+=a[e]+a[i]+"=="):2==p&&(s=h[c]<<8|h[c+1],e=(64512&s)>>10,i=(1008&s)>>4,o=(15&s)<<2,r+=a[e]+a[i]+a[o]+"="),r},i.prototype.events=new function(){var t={};this.on=function(e,i){t[e]||(t[e]=[]),t[e].push(i)},this.triggerHandler=function(e,i){if(t[e])for(var o in t[e])t[e][o](i)}}},function(module,exports,__webpack_require__){module.exports=function(angular,Cropper){__webpack_require__(4),angular.module("imageCropper").directive("imageCropper",function(){var imageCropperController=function($scope){var self=this;this.actionLabels=this.actionLabels(),this.apiCallback=this.api(),this.cropCallback=this.cropCallback(),this.fitOnInit=eval(this.fitOnInit),this.centerOnInit=eval(this.centerOnInit),this.checkCrossOrigin=eval(this.checkCrossOrigin),this.showControls=eval(this.showControls),this.init=function(){this.target=this.element,this.api=new Cropper(self),$scope.$watch("vm.imageUrl",function(t,e){angular.isDefined(t)&&!angular.equals(t,e)&&(console.log("change image, old: "+e+", new: "+t),self.api.changeImage(t))})}};return imageCropperController.$inject=["$scope"],{restrict:"E",scope:{centerOnInit:"@",checkCrossOrigin:"@",cropCallback:"&",api:"&",fitOnInit:"@",height:"@",imageUrl:"@",showControls:"@",width:"@",zoomStep:"@",actionLabels:"&"},bindToController:!0,controllerAs:"vm",controller:imageCropperController,link:function(t,e,i,o){o.element=e[0],o.init()}}})}},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_7__}])});
//# sourceMappingURL=angular-image-cropper.js.map